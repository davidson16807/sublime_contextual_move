% https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZAZgBoAWAXVJADcBDAGwFcYkQAhEAX1PU1z5CKMgFZqdJq3YBRHnxAZseAkVEUJDFm0QgACvP7Kha0gCZNUnfsOKBK4SVIBGS9tm2lg1SNIAGN2ldLl4jb0czF0DrACVPexMUSPEaLSCQONC7Yx9kSIBOaPZMhS8HIjIADiLg+JzHMkLUqw8sssTkdQB2Gps2hNy-Uh7m910AFTrwoiHiXsnuCRgoAHN4IlAAMwAnCABbJEiQHAgkIckxxW2YWgAjGBWsQhpGenvGPQHhEG2sFYALHC2Hb7Q40E5IZyjdJgGAADxwMDAUGBuwOiChx1OiHOaWsaGudweT1RoJx4OxmLg-ywmyBiAAtJi8exYQikSisiD0ecIYgyBd0gSbgBjf70bYgF5vGAfL7sRgwOmk9ECvnqQX4wn3R7PECvd6fersX4AoFctFIDV88gWskANgpSHILye1igEBwiM5Cm5SEdWKtrth7A9XuWKqQXSdiADjDd7DgEHjKOhWpu10eqjt6JdgcQGuptPpTJzUZj53jId0Ye9kcQ0fzmKr7s9dbLiEqMeclYTNbbEY7Xfz+WDrfDPq2lobMeHLcTyawqc1rPhOEzJmlhvlulNgPro6b5yLysZzg7PZj+Qv3eZLV0bJwYolUv1Mrlxt0iuVF8xfJ7F5HHyjbzv2E71s4QHYnOfYgLWg6+tOzhqticawfBk4gH6GIoeW+roQOmHYY2-4CieJbnohZIkZSRzkZCHZQUgxAdrhiB0TSp6llR6JMRilFTmSzh-tiHHFgxPFnBWLwQBAaBEM4lRDJsTBwDAEgGrKRrTLufz7mm7DCkSuoHleMlyQpSmkCpjBqRp77aeUulmq+LK6EZOokjeTbmfJKDKap6lblpO4-HpQIGQ+a4chBvKUpWsl+cgAW2UFb7bp+YUuZF4DRci9bWtiGqMIllkpXZwUfjpWX6Su7nasShAdnmNq+TM1mBfZGXVXuEV1bl7L5Ys3BAA
\begin{tikzcd}
                                            &  &                                                                                                                                                  & B \arrow[d] \arrow["prevbegin"', loop, distance=2em, in=125, out=55]                                                 &  &                                                                          \\
                                            &  & R \arrow[r, dotted] \arrow[ru, dotted]                                                                                                           & E \arrow[u, shift left] \arrow["nextend"', loop, distance=2em, in=305, out=235]                                      &  &                                                                          \\
                                            &  &                                                                                                                                                  &                                                                                                                      &  & P \arrow[lluu, "prevbegin"'] \arrow[dd, shift left]                      \\
T \arrow[rruu, dotted] \arrow[rrdd, dotted] &  &                                                                                                                                                  &                                                                                                                      &  &                                                                          \\
                                            &  &                                                                                                                                                  & B \arrow[d, "nextend", shift left] \arrow[rruu, "prevchar"] \arrow["prevbegin"', loop, distance=2em, in=125, out=55] &  & P \arrow[ll, "prevbegin"'] \arrow[lld, "nextend"] \arrow[uu] \arrow[ddd] \\
                                            &  & R \arrow[uuuu, "prevregion"] \arrow[ru, dotted] \arrow[r, dotted] \arrow[dddd, "nextregion"'] \arrow[lluu, shift left] \arrow[lldd, shift right] & E \arrow[u, "prevbegin"] \arrow[rrdd, "nextchar"] \arrow["nextend"', loop, distance=2em, in=305, out=235]            &  &                                                                          \\
                                            &  &                                                                                                                                                  &                                                                                                                      &  &                                                                          \\
T \arrow[rruu, dotted] \arrow[rrdd, dotted] &  &                                                                                                                                                  &                                                                                                                      &  & P \arrow[lldd] \arrow[uuu, shift right]                                  \\
                                            &  &                                                                                                                                                  & B \arrow[d, shift left] \arrow["prevbegin"', loop, distance=2em, in=125, out=55]                                     &  &                                                                          \\
                                            &  & R \arrow[r, dotted] \arrow[ru, dotted]                                                                                                           & E \arrow[u] \arrow["nextend"', loop, distance=2em, in=305, out=235]                                                  &  &                                                                         
\end{tikzcd}